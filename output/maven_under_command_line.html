<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="baidu-site-verification" content="N1Q3HiESgp" />

<title>Maven In Java — dengqinghua&#39;s blog</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/abcjs-midi.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/gitalk.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/Treant.css" />
  <link href="images/favicon.jpeg" rel="shortcut icon" type="image/x-icon" />
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body class="guide">
  <div id="topNav">
    <div class="wrapper">

      <strong class="more-info-label">More:</strong>

      <span class="red-button more-info-button">More Dengqinghua</span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://dengqinghua.github.io/about_me.html">About me</a></li>
        <li class="more-info"><a href="https://github.com/dengqinghua/">Github</a></li>
        <li class="more-info"><a href="mailto:dengqinghua.42@gmail.com">Gmail</a></li>
        <li class="more-info"><a href="https://twitter.com/dengqinghua_42">Twitter</a></li>
      </ul>

      <form action="https://google.com/search" method="get">
          <input name="q" value="site:dengqinghua.github.io" type="hidden">
          <input class="search" name="q" placeholder="Search Blog" type="text">
      </form>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="http://dengqinghua.github.io" title="Return to home page">http://dengqinghua.github.io</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="http://dengqinghua.github.io">Home</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">
            Index <span id="guidesArrow">▸</span>
          </a>

          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>推荐</dt>
                <dd><a href="badge_system.html">基于内存数据库的角标系统设计</a></dd>
                <dd><a href="witness_flow.html">业务流引擎系统</a></dd>
                <dt>Ruby</dt>
                <dd><a href="ruby_knowledge_tree.html">Ruby知识树</a></dd>
                <dd><a href="ruby_model.html">Ruby数据模型</a></dd>
                <dd><a href="arel.html?lang=en">Arel源码分析</a></dd>
                <dd><a href="sidekiq_task_event.html">基于Sidekiq的异步任务管理引擎</a></dd>
                <dd><a href="racc.html">Racc</a></dd>
                <dd><a href="witness_flow.html">业务流引擎系统</a></dd>
                <dt>Java</dt>
                <dd><a href="data_structures.html">数据结构</a></dd>
                <dd><a href="learn_jvm.html">JVM剖析</a></dd>
                <dd><a href="concurrency.html">Concurrency</a></dd>
                <dd><a href="badge_system.html">基于内存数据库的角标系统设计</a></dd>
                <dd><a href="maven_under_command_line.html">命令行下的Maven</a></dd>
                <dt>MySQL</dt>
                <dd><a href="mysql_knowledge_tree.html">MySQL知识树</a></dd>
              </dl>
              <dl class="R">
                <dt>Go</dt>
                <dd><a href="go_get_timeout_solution.html">GoInstallBinaries i/o timeout问题</a></dd>
                <dd><a href="go_knowledge_tree.html">Go知识树</a></dd>
                <dt>音乐</dt>
                <dd><a href="music_index.html">音乐学习体系</a></dd>
                <dd><a href="lalaland-city_of_stars.html">City Of Star</a></dd>
                <dd><a href="あの日の帰り道.html">あの日の帰り道</a></dd>
                <dd><a href="rain_wwh.html">雨の日はワルツを踊って</a></dd>
                <dd><a href="moon_river.html">Moon River</a></dd>
                <dd><a href="it_could_have_been.html">Es Ware Schon Gewesen</a></dd>
                <dt>杂记</dt>
                <dd><a href="example_markdown.html">markdown格式实例</a></dd>
                <dd><a href="comments.html">注释规范</a></dd>
                <dd><a href="best_programming.html">零bug落地方案</a></dd>
                <dd><a href="raft.html">Raft算法</a></dd>
                <dd><a href="memorize_my_mentor.html">Memorize My Mentor</a></dd>
              </dl>
          </div>
        </li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">Index</option>
              <optgroup label="推荐">
                  <option value="badge_system.html">基于内存数据库的角标系统设计</option>
                  <option value="witness_flow.html">业务流引擎系统</option>
              </optgroup>
              <optgroup label="Ruby">
                  <option value="ruby_knowledge_tree.html">Ruby知识树</option>
                  <option value="ruby_model.html">Ruby数据模型</option>
                  <option value="arel.html?lang=en">Arel源码分析</option>
                  <option value="sidekiq_task_event.html">基于Sidekiq的异步任务管理引擎</option>
                  <option value="racc.html">Racc</option>
                  <option value="witness_flow.html">业务流引擎系统</option>
              </optgroup>
              <optgroup label="Java">
                  <option value="data_structures.html">数据结构</option>
                  <option value="learn_jvm.html">JVM剖析</option>
                  <option value="concurrency.html">Concurrency</option>
                  <option value="badge_system.html">基于内存数据库的角标系统设计</option>
                  <option value="maven_under_command_line.html">命令行下的Maven</option>
              </optgroup>
              <optgroup label="MySQL">
                  <option value="mysql_knowledge_tree.html">MySQL知识树</option>
              </optgroup>
              <optgroup label="Go">
                  <option value="go_get_timeout_solution.html">GoInstallBinaries i/o timeout问题</option>
                  <option value="go_knowledge_tree.html">Go知识树</option>
              </optgroup>
              <optgroup label="音乐">
                  <option value="music_index.html">音乐学习体系</option>
                  <option value="lalaland-city_of_stars.html">City Of Star</option>
                  <option value="あの日の帰り道.html">あの日の帰り道</option>
                  <option value="rain_wwh.html">雨の日はワルツを踊って</option>
                  <option value="moon_river.html">Moon River</option>
                  <option value="it_could_have_been.html">Es Ware Schon Gewesen</option>
              </optgroup>
              <optgroup label="杂记">
                  <option value="example_markdown.html">markdown格式实例</option>
                  <option value="comments.html">注释规范</option>
                  <option value="best_programming.html">零bug落地方案</option>
                  <option value="raft.html">Raft算法</option>
                  <option value="memorize_my_mentor.html">Memorize My Mentor</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Maven In Java</h2><div class="date"><p>2018-02-12</p></div><p>本文档对Maven进行了介绍和分析.</p><p>阅读完该文档之后, 您将了解到:</p>
<ul>
<li>如何用命令行的Maven进行Run, Test和Debug.</li>
<li>Maven核心概念: Lifecycle, Plugin, Phases 和 Goal.</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li>
<a href="#maven%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%89%A7%E8%A1%8Cmain%E6%96%B9%E6%B3%95%E5%92%8Ctest">maven命令行执行main方法和test</a>

<ul>
<li><a href="#mvn-exec">mvn exec</a></li>
<li><a href="#mvn-test">mvn test</a></li>
</ul>
</li>
<li><a href="#maven-debug">Maven Debug</a></li>
<li>
<a href="#maven-purpose">Maven Purpose</a>

<ul>
<li><a href="#maven-archetype">Maven Archetype</a></li>
<li><a href="#pom">POM</a></li>
</ul>
</li>
<li>
<a href="#maven-lifecycle">Maven LifeCycle</a>

<ul>
<li><a href="#build-lifecycle">Build Lifecycle</a></li>
<li><a href="#phases">Phases</a></li>
<li><a href="#plugin-%E5%92%8C-goal">Plugin 和 Goal</a></li>
<li><a href="#%E5%A4%9A%E4%B8%AA%E6%9D%A1%E4%BB%B6%E7%BB%84%E5%90%88%E6%89%A7%E8%A1%8C">多个条件组合执行</a></li>
</ul>
</li>
<li><a href="#%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4%E8%A1%8C">其他命令行</a></li>
<li><a href="#references">References</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <div class="note"><p>请到<a href="https://github.com/dengqinghua/my_examples/tree/master/java">这里</a>查看完整示例代码</p></div><h3 id="maven命令行执行main方法和test"><a class="anchorlink" href="#maven%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%89%A7%E8%A1%8Cmain%E6%96%B9%E6%B3%95%E5%92%8Ctest">1 maven命令行执行main方法和test</a></h3><p>在开发java的时候, 我们经常重度依赖IDE, 但是IDE的可编辑的区域很小</p><p><img src="https://raw.githubusercontent.com/dengqinghua/roses/master/assets/images/badIde.png" alt="badIde"></p><div class="note"><p>写代码的区域很小, 建议关闭所有的窗口, 只留下写代码的区域.
另外, 可通过ideaVim可以自定制vim的<a href="https://github.com/dengqinghua/dotfiles#ideavimrc">快捷键</a>
来一键式关闭所有窗口, 也可以使用IDE的默认快捷键.</p></div><p>但是我们需要起main服务或者Run测试怎么办? 一般来说我们会在IDE下运行多个任务</p><p><img src="https://raw.githubusercontent.com/dengqinghua/roses/master/assets/images/runTestAndServerBoth.png" alt="runTestAndServerBoth"></p><p>这样写代码的区域会更少, 而且控制台会一直打开着, 占用写代码的区域.</p><p>为了解决上述问题, 我尝试用 Maven 原生的命令行来启动服务, 跑测试用例, 释放IDE.</p><h4 id="mvn-exec"><a class="anchorlink" href="#mvn-exec">1.1 mvn exec</a></h4><p>在上述的例子, 可以通过执行</p><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
mvn compile # 进行编译
mvn exec:java -Dexec.mainClass=com.dengqinghua.example.App # Run main方法

</pre>
</div>
<div class="note"><p>上述两个命令可以合并成一个 <code>mvn compile exec:java -Dexec.mainClass=com.dengqinghua.example.App</code></p></div><p>启动一个服务</p><p><img src="https://raw.githubusercontent.com/dengqinghua/roses/master/assets/images/incmdRun.png" alt="commandLine"></p><div class="info"><p>如果想指定不同的参数, 可以通过 -D 添加:</p></div><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
mvn compile exec:java -Dexec.mainClass=com.dengqinghua.example.App -Ddsg=v587

</pre>
</div>
<p><img src="https://raw.githubusercontent.com/dengqinghua/roses/master/assets/images/dsgv587Run.png" alt="commandLineWithArgus"></p><div class="note"><p>输入 mvn --help 可以看到: <code>-D,--define &lt;arg&gt;  Define a system property</code></p></div><div class="info"><p>在pom.xml文件中, 我们添加这个plugin, 可以实现增量编译和指定java编译的版本</p></div><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: true;">
&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
  &lt;version&gt;${compiler.plugin.version}&lt;/version&gt;
  &lt;configuration&gt;
    &lt;!-- 使用增量编译 --&gt;
    &lt;useIncrementalCompilation&gt;false&lt;/useIncrementalCompilation&gt;
    &lt;!-- 指定java的版本 --&gt;
    &lt;source&gt;1.8&lt;/source&gt;
    &lt;target&gt;1.8&lt;/target&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;

</pre>
</div>
<h4 id="mvn-test"><a class="anchorlink" href="#mvn-test">1.2 mvn test</a></h4><p>Maven test插件 <a href="http://maven.apache.org/surefire/maven-surefire-plugin/">maven-sirefile-plugin</a></p><p>她支持</p>
<ul>
<li>并发跑测试</li>
<li>指定某个单独的测试case</li>
<li>可以命令行执行, 并通过 -D 来添加参数</li>
</ul>
<h5 id="run所有的测试"><a class="anchorlink" href="#run%E6%89%80%E6%9C%89%E7%9A%84%E6%B5%8B%E8%AF%95">1.2.1 Run所有的测试</a></h5><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
mvn test

</pre>
</div>
<p><img src="https://raw.githubusercontent.com/dengqinghua/roses/master/assets/images/mavenTest.png" alt="mavenTest"></p><h5 id="run指定的class的测试"><a class="anchorlink" href="#run%E6%8C%87%E5%AE%9A%E7%9A%84class%E7%9A%84%E6%B5%8B%E8%AF%95">1.2.2 Run指定的class的测试</a></h5><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
mvn test -Dtest=SalaryTest

</pre>
</div>
<h5 id="run指定的方法"><a class="anchorlink" href="#run%E6%8C%87%E5%AE%9A%E7%9A%84%E6%96%B9%E6%B3%95">1.2.3 Run指定的方法</a></h5><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
mvn test -Dtest="SalaryTest#calculateYearSalary"

</pre>
</div>
<h5 id="添加参数"><a class="anchorlink" href="#%E6%B7%BB%E5%8A%A0%E5%8F%82%E6%95%B0">1.2.4 添加参数</a></h5><p>我们有时候需要建立一个client去调用远程的server, 配置的是 IP + 端口号, 而远程的server的地址是可变的, 我们可以写一个client去调用服务, 将服务的IP和端口号通过参数的形式传入.</p><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
mvn test -Dtest="SalaryTest#calculateYearSalary" -Dhosts=localhost:8000

</pre>
</div>
<p>另外一个场景: 我们需要测试不同的用户, 不同的性别下的一些信息, 可以传入多个参数</p><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
mvn test -Dtest="SalaryTest#calculateYearSalary" -DuserId=1024,1025 -Dsex=male

</pre>
</div>
<p>最近做的一个角标系统中, 需要传入多个商品id, 以及页面, 来源等信息, 有时候会调用本地服务, 有时候会直接调用线上的服务,
测试case如下</p><div class="code_container">
<pre class="brush: java; gutter: false; toolbar: true;">
public class ClientTest {
    /**
     * 获取角标数据
     *
     * mvn test -Dtest="ClientTest#getCornerData" -DproductId=1024,1025,1026 -Dchannel=2 -DclientType=2 -DuserType=2 -DuserRole=4 -Dhosts="192.168.11.11:12701"
     *
     */
    @Test public void getCornerData() throws Exception {
        String productId = System.getProperty("productId"),    // 商品id
                channel    = System.getProperty("channel"),    // 来源
                clientType = System.getProperty("clientType"), // 客户端
                userType   = System.getProperty("userType"),   // 身份
                userRole   = System.getProperty("userRole");   // 角色

        String hosts = Optional.
          ofNullable(System.getProperty("hosts")).
          orElse("localhost:12701");

        // ...
    }
}

</pre>
</div>
<p><code>maven test</code>除了上述功能外, 还支持输出测试覆盖率, 并发运行测试等, 更多内容请阅读官方文档.</p><h3 id="maven-debug"><a class="anchorlink" href="#maven-debug">2 Maven Debug</a></h3><p>有时候我们需要在程序进行调试, 如在 main 方法中添加断点</p><p><img src="https://raw.githubusercontent.com/dengqinghua/roses/master/assets/images/addBreakPoint.png" alt="addBreakPoint"></p><p>运行服务的时候此时需要以debug的方式启动.</p><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
mvnDebug compile exec:java -Dexec.mainClass="com.dengqinghua.example.App" -Ddsg=v587

</pre>
</div>
<p>此时程序会停止执行, 开启了一个 8000 的端口等待attached</p><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
➜  mvnDebug compile exec:java -Dexec.mainClass="com.dengqinghua.example.App" -Ddsg=v587

Preparing to execute Maven in debug mode
Listening for transport dt_socket at address: 8000

</pre>
</div>
<div class="info"><p>Maven调用了原生的<a href="https://docs.oracle.com/javase/7/docs/technotes/tools/solaris/jdb.html">jdb</a></p></div><p>可以使用 IDE 创建一个 <a href="https://www.jetbrains.com/help/idea/run-debug-configuration-remote-debug.html">RemoteDebug</a></p><p><img src="https://raw.githubusercontent.com/dengqinghua/roses/master/assets/images/addDebug.png" alt="addDebug"></p><p><img src="https://raw.githubusercontent.com/dengqinghua/roses/master/assets/images/addRemoteDebug.png" alt="addRemoteDebug"></p><p>填写相应参数</p>
<ul>
<li>Host: localhost</li>
<li>Port: 8000</li>
<li>Name: mvnDebug</li>
<li>Module's classpath: my-example</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dengqinghua/roses/master/assets/images/createMVNDebug.png" alt="createMVNDebug"></p><div class="note"><p>线上的代码也可以用类似的方式进行debug, 只需要改变Host和Port, 并在启动的时候添加Debug参数即可</p></div><p>运行debug</p><p><img src="https://raw.githubusercontent.com/dengqinghua/roses/master/assets/images/runDebug.png" alt="runDebug"></p><p>最终可以在IDE中捕获到断点, 并进行调试</p><p><img src="https://raw.githubusercontent.com/dengqinghua/roses/master/assets/images/goIntoBreakpoint.png" alt="goIntoBreakpoint"></p><h3 id="maven-purpose"><a class="anchorlink" href="#maven-purpose">3 Maven Purpose</a></h3>
<blockquote>
Maven’s primary goal is to allow a developer to comprehend the complete state of a development effort in the shortest period of time
<div class="info"><p>Maven的介绍请查看官网: <a href="https://maven.apache.org/what-is-maven.html">What is Maven?</a> 和 <a href="https://maven.apache.org/guides/getting-started/maven-in-five-minutes.html">Maven In 5 Minutes</a></p></div>
</blockquote>
<p>受到 <a href="http://rubyonrails.org/">Rails</a>的影响, 由Ruby转到Java的时候, 希望能有像Rails这种基于<a href="https://en.wikipedia.org/wiki/Convention_over_configuration">Convention Over Configuratoin</a>理念设计的框架. Maven是, 她配置的细节真正地做到了最小化. 基于使用角度和最佳实践的角度.</p><p>她提供了完整地一套开发流程, 包括:</p>
<ul>
<li>创建项目</li>
<li>包依赖管理, 生成项目文件结构目录</li>
<li>测试和测试覆盖率</li>
<li>打包等</li>
</ul>
<p>除此之外, Maven还提供了非常丰富的命令行交互, 包括像上述过程中描述的命令行中Run main方法, debug, test等. 这些对于本人这种喜欢CLI的程序员欣喜若狂.</p><h4 id="maven-archetype"><a class="anchorlink" href="#maven-archetype">3.1 Maven Archetype</a></h4><p>利用Maven创建项目</p><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
mvn archetype:generate -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false -DarchetypeCatalog=internal\
  -DgroupId=com.dengqinghua.example\
  -DartifactId=my-example\

</pre>
</div>
<p>构建的文件目录为:</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: true;">
▾ src/
  ▾ main/java/com/dengqinghua/example/
      App.java
  ▾ test/java/com/dengqinghua/example/
      AppTest.java
  pom.xml

</pre>
</div>
<h4 id="pom"><a class="anchorlink" href="#pom">3.2 POM</a></h4><p>Project Object Model 是maven的核心配置文件, 我的常用的POM插件和依赖如下:</p><p>常用的几个配置属性</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>释义</th>
</tr>
</thead>
<tbody>
<tr>
<td>dependencies</td>
<td>包依赖</td>
</tr>
<tr>
<td>plugins</td>
<td>mvn所开发的插件, 在test, package, install等场景使用. 如 maven-surefire-plugin, 支持完整的 junit 测试框架, 并在其基础上可以实现并发跑测试</td>
</tr>
<tr>
<td>properties</td>
<td>属性配置, 可以在配置中通过 ${} 进行调用</td>
</tr>
</tbody>
</table>
<h5 id="pom文件"><a class="anchorlink" href="#pom%E6%96%87%E4%BB%B6">3.2.1 POM文件</a></h5>
<ol>
<li>项目级别的pom, 位于项目下的pom.xml</li>
<li>用户级别的pom, 位于 <code>~/.m2/settings.xml</code>
</li>
<li>全局配置的pom, 位于 <code>M2_HOME/conf/settings.xml</code>
</li>
</ol>
<p>其中优先级为: 项目级别 &gt; 用户级别 &gt; 全局配置</p><div class="note"><p>M2_HOME 可以通过<code>mvn --version</code>查看; 另外, 可以通过<code>mvn help:effective-pom</code>查看当前的完整的配置的 pom</p></div><h3 id="maven-lifecycle"><a class="anchorlink" href="#maven-lifecycle">4 Maven LifeCycle</a></h3><p>官方文档: <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html">Introduction to the Build Lifecycle</a></p><div class="info"><p>建议完整地看完上述文档, 下面的内容没有什么新的东西, 仅仅是上述文档的总结和翻译, 此外, 需要理解 Lifecycle, Phases, Plugin 和 Goal 的区别和关系. 在<a href="https://stackoverflow.com/questions/16205778/what-are-maven-goals-and-phases-and-what-is-their-difference">这篇文章</a>中有讨论.</p></div><h4 id="build-lifecycle"><a class="anchorlink" href="#build-lifecycle">4.1 Build Lifecycle</a></h4><p>mvn 支持的三个lifecycle 包括:</p>
<ul>
<li>defalut</li>
<li>clean</li>
<li>site</li>
</ul>
<h5 id="default"><a class="anchorlink" href="#default">4.1.1 default</a></h5><p>一个完整的default lifecycle包括下面几部分:</p>
<ul>
<li>validate - validate the project is correct and all necessary information is available</li>
<li>compile - compile the source code of the project</li>
<li>test - test the compiled source code using a suitable unit testing framework. These tests should not require the code be packaged or deployed</li>
<li>package - take the compiled code and package it in its distributable format, such as a JAR.</li>
<li>verify - run any checks on results of integration tests to ensure quality criteria are met</li>
<li>install - install the package into the local repository, for use as a dependency in other projects locally</li>
<li>deploy - done in the build environment, copies the final package to the remote repository for sharing with other developers and projects.</li>
</ul>
<p>上面是有顺序而且相互依赖的. 比如当执行 mvn test 的时候, 其实也运行了 validate 和 compile 这两个步骤</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: true;">
➜  mvn test
[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building my-example 1.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ my-example ---
[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!
[INFO] skip non existing resourceDirectory /Users/dengqinghua/git/learning/java/maven/new-project/my-example/src/main/resources
[INFO]
[INFO] --- maven-compiler-plugin:3.5.1:compile (default-compile) @ my-example ---
[WARNING] File encoding has not been set, using platform encoding UTF-8, i.e. build is platform dependent!
[INFO] Compiling 2 source files to /Users/dengqinghua/git/learning/java/maven/new-project/my-example/target/classes
[INFO]
[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ my-example ---
[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources, i.e. build is platform dependent!
[INFO] skip non existing resourceDirectory /Users/dengqinghua/git/learning/java/maven/new-project/my-example/src/test/resources
[INFO]
[INFO] --- maven-compiler-plugin:3.5.1:testCompile (default-testCompile) @ my-example ---
[WARNING] File encoding has not been set, using platform encoding UTF-8, i.e. build is platform dependent!
[INFO] Compiling 2 source files to /Users/dengqinghua/git/learning/java/maven/new-project/my-example/target/test-classes
[INFO]
[INFO] --- maven-surefire-plugin:2.20.1:test (default-test) @ my-example ---
[INFO]
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running com.dengqinghua.calculate.SalaryTest
null
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.09 s - in com.dengqinghua.calculate.SalaryTest
[INFO] Running com.dengqinghua.example.AppTest
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 s - in com.dengqinghua.example.AppTest
[INFO]
[INFO] Results:
[INFO]
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 3.751 s
[INFO] Finished at: 2018-02-12T18:24:49+08:00
[INFO] Final Memory: 17M/167M
[INFO] ------------------------------------------------------------------------

</pre>
</div>
<p>可以看到, 其中<code>mvn test</code>执行的操作包括(其中validate没有日志输出):</p>
<ul>
<li>maven-resources-plugin:2.6:resources</li>
<li>maven-compiler-plugin:3.5.1:compile</li>
<li>maven-resources-plugin:2.6:testResources</li>
<li>maven-compiler-plugin:3.5.1:testCompile</li>
<li>maven-surefire-plugin:2.20.1:test</li>
</ul>
<p>所以 上述是一个 "Build Lifecycle" 的过程. 不仅是 mvn test, 像 mvn compile, mvn install, mvn deploy 等, 都是一个 "Build Lifecycle".
在这个过程中, 排在当前命令之前的所有命令都会被执行.</p><h5 id="mvn-clean-和-mvn-site"><a class="anchorlink" href="#mvn-clean-%E5%92%8C-mvn-site">4.1.2 mvn clean 和 mvn site</a></h5><p>请参考官方文档: <a href="http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Lifecycle_Reference">Lifecycle_Reference</a></p>
<ul>
<li>clean 删除项目 target 文件夹下的文件</li>
<li>site 生成项目信息的文档, 包括Dependencies等</li>
</ul>
<h4 id="phases"><a class="anchorlink" href="#phases">4.2 Phases</a></h4>
<blockquote>
<p>A Build Lifecycle is Made Up of Phases</p>
</blockquote>
<p>Phases 是指 lifecycle 下的命令</p><p>如:</p>
<ul>
<li>validate</li>
<li>compile</li>
<li>test</li>
<li>package</li>
<li>verify</li>
<li>install</li>
<li>deploy</li>
<li>clean</li>
<li>site</li>
</ul>
<p>mvn test 中 test 就是一个 Phase</p><h4 id="plugin-和-goal"><a class="anchorlink" href="#plugin-%E5%92%8C-goal">4.3 Plugin 和 Goal</a></h4>
<blockquote>
<p>A Build Phase is Made Up of Plugin Goals</p>
</blockquote>
<p>下面的命令:</p><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
mvn dependency:copy-dependencies

</pre>
</div>
<p>其中 <code>dependency</code> 为 plugin, <code>copy-dependencies</code> 为 goal.</p><p>Phase是由一系列的 plugin 和 goal 组成的, 如</p><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
mvn test

</pre>
</div>
<p>测试环节使用到的plugin和goal为</p><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
mvn surefire:test

</pre>
</div>
<div class="info"><p>如果单独运行 mvn surefire:test, 则不会经过 compile 的过程</p></div><p>plugin 和 goal 又可以独立存在. 如上述的例子, exec:java 不属于任何Phase</p><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
mvn exec:java -Dexec.mainClass="com.dengqinghua.example.App" -Ddsg=v587

</pre>
</div>
<h4 id="多个条件组合执行"><a class="anchorlink" href="#%E5%A4%9A%E4%B8%AA%E6%9D%A1%E4%BB%B6%E7%BB%84%E5%90%88%E6%89%A7%E8%A1%8C">4.4 多个条件组合执行</a></h4><p>Maven支持多个命令组合执行, 比如希望先清除已编译的class文件(clean), 再进行install, 最后运行一个 exec 服务, 可以这样执行</p><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
mvn clean install exec:java -Dexec.mainClass="com.dengqinghua.example.App" -Ddsg=v587

</pre>
</div>
<h3 id="其他命令行"><a class="anchorlink" href="#%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4%E8%A1%8C">5 其他命令行</a></h3><div class="info"><p>如果您使用zsh, 建议在 ~/.zshrc 的 plugins 中添加 mvn</p></div><div class="code_container">
<pre class="brush: shell; gutter: false; toolbar: true;">
plugins=(git brew osx git-flow vue mvn)

</pre>
</div>
<p>之后在console中可以进行补全</p>
<ul>
<li>mvn dependency:tree</li>
<li>mvn install -Dmaven.test.skip=true # 忽略测试</li>
<li>mvn -U clean install # FORCE update-snapshots</li>
<li>mvn -o clean install # 不检查 dependencies 是否更新</li>
<li>mvn -Dplugin=install help:describe # 查看plugin的版本</li>
<li>mvn help:effective-pom # 查看当前生效的pom配置信息</li>
</ul>
<h3 id="references"><a class="anchorlink" href="#references">6 References</a></h3>
<ul>
<li><a href="http://maven.apache.org/general.html">Maven FAQ</a></li>
<li><a href="http://maven.apache.org/guides/getting-started/maven-in-five-minutes.html">Maven In 5 Minutes</a></li>
<li><a href="http://maven.apache.org/guides/getting-started/index.html">Maven Get Started</a></li>
<li><a href="https://www.tutorialspoint.com/maven/">Maven Tutorial</a></li>
</ul>


        <div id="comment"></div>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>版权声明：自由转载-非商用-非衍生-保持署名(<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">创意共享3.0许可证</a>)</p>
<p>
  <a href="https://github.com/996icu/996.ICU/blob/master/LICENSE"><img src="https://img.shields.io/badge/license-Anti%20996-blue.svg" /></a>
</p>

    </div>
  </div>

  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/acoustic_grand_piano-ogg.js"></script>

  <!-- ./node_modules/gulp/bin/gulp.js build -\-brushes=bash,cpp,css,javascript,java,plain,python,ruby,scala,sql,xml -->
  <!-- uglifyjs syntaxhighlighter.js  -\-output syntaxhighlighter.min.js -->
  <script type="text/javascript" src="javascripts/syntaxhighlighter.min.js"></script>
  <script type="text/javascript" src="javascripts/tonal.min.js"></script>
  <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tone/13.0.1/Tone.min.js"></script> -->
  <script type="text/javascript" src="javascripts/Tone.min.js"></script>
  <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.6.4/svg.min.js"></script> -->
  <script type="text/javascript" src="javascripts/svg.min.js"></script>
  <script type="text/javascript" src="javascripts/chordy-svg.min.js"></script>
  <script type="text/javascript" src="javascripts/chord.js"></script>
  <!-- <script type="text/javascript" src="javascripts/gitalk.min.js"></script> -->
  <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.2.2/gitalk.min.js"></script> -->
  <script type="text/javascript" src="javascripts/gitalk.min.js"></script>
  <script type="text/javascript" src="javascripts/load_docs.js"></script>
  <script type="text/javascript" src="javascripts/Treant.js"></script>
  <!-- <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.0/raphael&#45;min.js"></script> -->
  <script type="text/javascript" src="javascripts/raphael.min.js"></script>
  <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.11.0/flowchart.min.js"></script> -->
  <script type="text/javascript" src="javascripts/flowchart.min.js"></script>
  <script type="text/javascript" src="javascripts/flowchart_generator.js"></script>
  <script type="text/javascript" src="javascripts/tree_generator.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-115746206-1"></script>

  <script type="text/javascript" src="javascripts/abcjs_midi_5.1.2-min.js"></script>
  <script type="text/javascript" src="javascripts/music_generator.js"></script>

  <script type="text/javascript">
    syntaxhighlighterConfig = {
      autoLinks: false,
    };

    $(guidesIndex.bind);

    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-115746206-1');
  </script>

  <script type="text/javascript">
    var locationId = (location.pathname).split("/").pop().substring(0, 49);

    if (locationId) {
      var language = window.location.search.match("lang=en") ? "en" : "zh-CN"

      if (window.location.href.match("github")) {
        var gitalk = new Gitalk({
          clientID: '85c5f833b04d6d470db9',
          clientSecret: 'b41619fc891132558550103056197eb30baebab5',
          repo: 'blog-github-page-comments',
          owner: 'dengqinghua',
          admin: ['dengqinghua'],
          id: locationId,
          distractionFreeMode: true,
          language: language
        });
      } else {
        var gitalk = new Gitalk({
          clientID: '0f5824fe1c09851e9781',
          clientSecret: '61710a77ee98cddce06f408a398f05c8622e9575',
          repo: 'blog_comments',
          owner: 'dengqinghua',
          admin: ['dengqinghua'],
          id: locationId,
          distractionFreeMode: true,
          language: language
        });
      }

      gitalk.render('comment');
    }
  </script>
</body>
</html>
