<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="baidu-site-verification" content="N1Q3HiESgp" />

<title>Raft算法 — dengqinghua&#39;s blog</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/abcjs-midi.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/gitalk.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/Treant.css" />
  <link href="images/favicon.jpeg" rel="shortcut icon" type="image/x-icon" />
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body class="guide">
  <div id="topNav">
    <div class="wrapper">

      <strong class="more-info-label">More:</strong>

      <span class="red-button more-info-button">More Dengqinghua</span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://dengqinghua.github.io/about_me.html">About me</a></li>
        <li class="more-info"><a href="https://github.com/dengqinghua/">Github</a></li>
        <li class="more-info"><a href="mailto:dengqinghua.42@gmail.com">Gmail</a></li>
        <li class="more-info"><a href="https://twitter.com/dengqinghua_42">Twitter</a></li>
      </ul>

      <form action="https://google.com/search" method="get">
          <input name="q" value="site:dengqinghua.github.io" type="hidden">
          <input class="search" name="q" placeholder="Search Blog" type="text">
      </form>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="http://dengqinghua.github.io" title="Return to home page">http://dengqinghua.github.io</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="http://dengqinghua.github.io">Home</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">
            Index <span id="guidesArrow">▸</span>
          </a>

          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>推荐</dt>
                <dd><a href="badge_system.html">基于内存数据库的角标系统设计</a></dd>
                <dd><a href="witness_flow.html">业务流引擎系统</a></dd>
                <dt>Ruby</dt>
                <dd><a href="ruby_knowledge_tree.html">Ruby知识树</a></dd>
                <dd><a href="ruby_model.html">Ruby数据模型</a></dd>
                <dd><a href="arel.html?lang=en">Arel源码分析</a></dd>
                <dd><a href="sidekiq_task_event.html">基于Sidekiq的异步任务管理引擎</a></dd>
                <dd><a href="racc.html">Racc</a></dd>
                <dd><a href="witness_flow.html">业务流引擎系统</a></dd>
                <dt>Java</dt>
                <dd><a href="data_structures.html">数据结构</a></dd>
                <dd><a href="learn_jvm.html">JVM剖析</a></dd>
                <dd><a href="concurrency.html">Concurrency</a></dd>
                <dd><a href="badge_system.html">基于内存数据库的角标系统设计</a></dd>
                <dd><a href="maven_under_command_line.html">命令行下的Maven</a></dd>
                <dt>MySQL</dt>
                <dd><a href="mysql_knowledge_tree.html">MySQL知识树</a></dd>
              </dl>
              <dl class="R">
                <dt>Go</dt>
                <dd><a href="go_get_timeout_solution.html">GoInstallBinaries i/o timeout问题</a></dd>
                <dd><a href="go_knowledge_tree.html">Go知识树</a></dd>
                <dt>音乐</dt>
                <dd><a href="music_index.html">音乐学习体系</a></dd>
                <dd><a href="lalaland-city_of_stars.html">City Of Star</a></dd>
                <dd><a href="あの日の帰り道.html">あの日の帰り道</a></dd>
                <dd><a href="rain_wwh.html">雨の日はワルツを踊って</a></dd>
                <dd><a href="moon_river.html">Moon River</a></dd>
                <dd><a href="it_could_have_been.html">Es Ware Schon Gewesen</a></dd>
                <dt>杂记</dt>
                <dd><a href="example_markdown.html">markdown格式实例</a></dd>
                <dd><a href="comments.html">注释规范</a></dd>
                <dd><a href="best_programming.html">零bug落地方案</a></dd>
                <dd><a href="raft.html">Raft算法</a></dd>
                <dd><a href="memorize_my_mentor.html">Memorize My Mentor</a></dd>
              </dl>
          </div>
        </li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">Index</option>
              <optgroup label="推荐">
                  <option value="badge_system.html">基于内存数据库的角标系统设计</option>
                  <option value="witness_flow.html">业务流引擎系统</option>
              </optgroup>
              <optgroup label="Ruby">
                  <option value="ruby_knowledge_tree.html">Ruby知识树</option>
                  <option value="ruby_model.html">Ruby数据模型</option>
                  <option value="arel.html?lang=en">Arel源码分析</option>
                  <option value="sidekiq_task_event.html">基于Sidekiq的异步任务管理引擎</option>
                  <option value="racc.html">Racc</option>
                  <option value="witness_flow.html">业务流引擎系统</option>
              </optgroup>
              <optgroup label="Java">
                  <option value="data_structures.html">数据结构</option>
                  <option value="learn_jvm.html">JVM剖析</option>
                  <option value="concurrency.html">Concurrency</option>
                  <option value="badge_system.html">基于内存数据库的角标系统设计</option>
                  <option value="maven_under_command_line.html">命令行下的Maven</option>
              </optgroup>
              <optgroup label="MySQL">
                  <option value="mysql_knowledge_tree.html">MySQL知识树</option>
              </optgroup>
              <optgroup label="Go">
                  <option value="go_get_timeout_solution.html">GoInstallBinaries i/o timeout问题</option>
                  <option value="go_knowledge_tree.html">Go知识树</option>
              </optgroup>
              <optgroup label="音乐">
                  <option value="music_index.html">音乐学习体系</option>
                  <option value="lalaland-city_of_stars.html">City Of Star</option>
                  <option value="あの日の帰り道.html">あの日の帰り道</option>
                  <option value="rain_wwh.html">雨の日はワルツを踊って</option>
                  <option value="moon_river.html">Moon River</option>
                  <option value="it_could_have_been.html">Es Ware Schon Gewesen</option>
              </optgroup>
              <optgroup label="杂记">
                  <option value="example_markdown.html">markdown格式实例</option>
                  <option value="comments.html">注释规范</option>
                  <option value="best_programming.html">零bug落地方案</option>
                  <option value="raft.html">Raft算法</option>
                  <option value="memorize_my_mentor.html">Memorize My Mentor</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Raft算法</h2><div class="date"><p>2018-05-11</p></div><p>本文档总结了Raft的知识树.</p><p>阅读完该文档后，您将会了解到Raft算法的</p>
<ul>
<li>Status Change</li>
<li>Leader Election</li>
<li>Log Replication</li>
<li>Append Entries</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li>
<a href="#overview">Overview</a>

<ul>
<li><a href="#replicated-state-machine-architecture">Replicated state machine architecture</a></li>
<li><a href="#key-concepts">Key Concepts</a></li>
<li><a href="#consensus-problems-to-subproblems">Consensus Problems to Subproblems</a></li>
</ul>
</li>
<li>
<a href="#leader-election">Leader Election</a>

<ul>
<li><a href="#status">Status</a></li>
<li><a href="#flow">Flow</a></li>
<li><a href="#%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98">超时问题</a></li>
</ul>
</li>
<li>
<a href="#log-replication">Log Replication</a>

<ul>
<li><a href="#log-replication-overview">Overview</a></li>
<li><a href="#%E6%A3%80%E6%B5%8B%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84%E6%96%B9%E5%BC%8F">检测不一致的方式</a></li>
<li><a href="#committed">Committed</a></li>
</ul>
</li>
<li>
<a href="#cluster-memeber-changed">Cluster Memeber Changed</a>

<ul>
<li><a href="#joint-consensus">Joint Consensus</a></li>
</ul>
</li>
<li><a href="#client-interaction">Client Interaction</a></li>
<li><a href="#references">References</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="overview"><a class="anchorlink" href="#overview">1 Overview</a></h3><div class="note"><p>推荐这篇Paper: <a href="https://raft.github.io/raft.pdf">In Search of an Understandable Consensus Algorithm</a></p></div>
<ul>
<li>Leader Election</li>
<li>Log Replication</li>
<li>Safety</li>
</ul>
<h4 id="replicated-state-machine-architecture"><a class="anchorlink" href="#replicated-state-machine-architecture">1.1 Replicated state machine architecture</a></h4><p>分布式数据一致性算法的一个经典的架构为 Replication state machine, 即</p>
<ul>
<li>记录多个日志(Replicated Log)</li>
<li>维护了一个最终状态的状态机(State Machine).</li>
</ul>
<p>任何一台服务器挂掉或者无法进行通信时,
新的服务器可通过日志进行数据的回溯和重算. 得到当前的最终的状态, 并代替原有服务器, 和client进行通信</p><p><img src="https://raw.githubusercontent.com/dengqinghua/roses/master/assets/images/replicated_state_machine_architecture.png" alt="replicated_state_machine_architecture"></p><p>Client 和 Server 通信的时候(上图中的步骤1), Server端会写log, 其中log记录的是 <strong>数据的变化过程</strong>, 并同步到多个机器中(步骤2),
存在一个状态机, 状态机保存的是数据的<strong>最终结果</strong>(步骤3), 状态机计算完结果之后, 将结果返回给Client通信成功(步骤4)</p><p>论文原文摘录:</p>
<blockquote>
<p>Keeping the replicated log consistent is the job of the consensus algorithm. The consensus module on a server receives commands from clients and adds them to its log. It communicates with the consensus modules on other servers to <strong>ensure that every log eventually contains the same requests in the same order, even if some servers fail</strong>. Once <strong>commands</strong> are properly replicated, each server’s state machine processes them in log order, and the outputs are returned to clients. As a result, the servers appear to form a single, highly reliable state machine.</p>
</blockquote>
<div class="note"><p>在Kafka的<a href="https://zhuanlan.zhihu.com/p/27587872">高可用策略</a>中, 也采用了相应的策略: Leader先写日志, 在成功同步到半数以上的Follower之后, 才返回给客户端ack.</p></div><h4 id="key-concepts"><a class="anchorlink" href="#key-concepts">1.2 Key Concepts</a></h4><p>核心的概念如下:</p>
<ol>
<li>
<p>Leader</p>
<p>用于和Client交互的载体</p>
</li>
<li>
<p>Term</p>
<p>时间序列编号(Terms act as a logical clock in Raft), 每一次Election之后, term 会递增.</p>
<p>在做心跳的时候, term信息是一直传输的</p>
<blockquote>
<p>Raft divides time into terms of arbitrary length. Terms are numbered with consecutive integers, and each term begins with an election.</p>
</blockquote>
</li>
<li>
<p>Log Entries</p>
<p>用于记录 commands, 即所有的操作</p>
</li>
</ol>
<h4 id="consensus-problems-to-subproblems"><a class="anchorlink" href="#consensus-problems-to-subproblems">1.3 Consensus Problems to Subproblems</a></h4><div class="note"><p>Raft算法将 一致性问题 拆分成了 三个子问题: <code>leader election</code>, <code>log replicated</code> 和 <code>safety</code></p></div><h5 id="leader-election-problem"><a class="anchorlink" href="#leader-election-problem">1.3.1 Leader Election Problem</a></h5><p>Leader挂了, 将重新进行election, 选出新的Leader</p><p>选取的时候会查看 被选取的candidate的时间序列term和对应的log Index 和 自身的对比.</p><p>仅仅当</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: true;">
candidate's term &gt; voter's term ||
(candidate's term == voter's term &amp;&amp;
candidate's latestLogIndex &gt;= voter's latestLogIndex
)

</pre>
</div>
<p>这个candidate才能得到voter的赞成票.</p><div class="note"><p>选举的规则非常重要, 这个规则和commited的概念一起, 解决了后面safety问题</p></div><h5 id="log-replication-problem"><a class="anchorlink" href="#log-replication-problem">1.3.2 Log Replication Problem</a></h5><p>Leader接收到消息之后, 需要写入log, 并将这些log同步到大多数的Follower
去, Follower 返回ack 之后, Leader 才返回给Client ack.</p><h5 id="safety-problem"><a class="anchorlink" href="#safety-problem">1.3.3 Safety Problem</a></h5>
<ul>
<li>Election restriction</li>
<li>Leader, Follower, Candidate crashed</li>
</ul>
<h3 id="leader-election"><a class="anchorlink" href="#leader-election">2 Leader Election</a></h3><h4 id="status"><a class="anchorlink" href="#status">2.1 Status</a></h4><p>Raft算法每一个节点都有三个状态, 也可以认为是三种身份:</p>
<ul>
<li>Follower</li>
<li>Candidate</li>
<li>Leader</li>
</ul>
<div class="note"><p>所有的交互都是跟 Leader 进行, 变化会写入 Leader 的log, 再进行 Log Replication, 采用的方式为 Append Entries.</p></div><p>状态变化如下图:</p><p><img src="https://raw.githubusercontent.com/dengqinghua/roses/master/assets/images/raft_status_change.png" alt="raft_status_change"></p><p>大型的分布式系统都会有一个 <code>replicated state machine</code></p>
<blockquote>
<p>Large-scale systems that have a single cluster leader, such as GFS, HDFS, and RAMCloud, typically use a separate <strong>replicated state machine</strong> to manage leader election and store configuration information that must survive leader crashes. Examples of replicated state machines include Chubby and ZooKeeper.</p>
</blockquote>
<h4 id="flow"><a class="anchorlink" href="#flow">2.2 Flow</a></h4><p>Raft采用心跳 <strong>Heartbeat mechanism</strong> 来触发Election.</p><p>Leader会周期性地给Follower
发送心跳, 一旦Follower接收不到消息, 则会重新进行Election</p><div class="flowchart" style="display:none" id="98f6bdde9a755b5be5137cef8c0114df">
  init=&gt;start: Follower无法接收到Leader发出的
Heartbeat(即Election Timeout)
be_candidate=&gt;operation: Follower变成Candidate
时间序列Term++
vote=&gt;operation: Candidate
让剩下的nodes
进行Vote
reply=&gt;operation: 其他的nodes进行vote
become_leader=&gt;condition: Candidate
获取到大多数
nodes的投票
become_leader_yes=&gt;operation: Candidate变成Leader
send_heartbeat=&gt;end: 发送Heartbeat信息
停止其他节点的election
init-&gt;be_candidate-&gt;vote-&gt;reply-&gt;become_leader
become_leader(yes)-&gt;become_leader_yes-&gt;send_heartbeat
become_leader(no)-&gt;be_candidate
</div>
<h4 id="超时问题"><a class="anchorlink" href="#%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98">2.3 超时问题</a></h4><p>一个Candidate进行Election可能会出现下面三种情况</p>
<ul>
<li>成功</li>
<li>失败, 其他的Candidate变成了Leader</li>
<li>超时, 在一定时间内没有收到投票</li>
</ul>
<p>如果超时了, 会再次进行选取, 此时如果有多个Follower变成了Candidate(Split), 则
有可能谁都不会胜利, 拿不到大多数的投票, 此时会变回Follower, 并进行随机时间区间(150ms-300ms)的等待
(randomized election timeouts),
再进行下一步的leader选取.</p><p>由于等待了随机的时间, 再次Split的概率就会很小.</p><h3 id="log-replication"><a class="anchorlink" href="#log-replication">3 Log Replication</a></h3><h4 id="log-replication-overview"><a class="anchorlink" href="#log-replication-overview">3.1 Overview</a></h4><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: true;">
leader_write_log # 写日志(不提交)
leader_send_replicate # 复制节点, 发送给follower
leader_get_majority_of_followers_ack # 获得大多数的follower的确认写入
leader_commit # leader 提交(Committed)

</pre>
</div>

<blockquote>
<p>If followers crash or run slowly, or if network packets are lost, the leader <strong>retries AppendEntries RPCs indefinitely</strong> (even after it has responded to the client) until all followers eventually store all log entries.</p>
</blockquote>
<h4 id="检测不一致的方式"><a class="anchorlink" href="#%E6%A3%80%E6%B5%8B%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84%E6%96%B9%E5%BC%8F">3.2 检测不一致的方式</a></h4><p>Leader写入的log形式如下:</p><p><img src="https://raw.githubusercontent.com/dengqinghua/roses/master/assets/images/raft_log_entries.png" alt="raft_log_entries"></p><p>其中不同的颜色, 代表不同的term.</p><p>通过term值和log的最大的index,
Leader可以知道Follower的Log Entries是否已经追上或者是落后. 如果发现落后了,
则在下次心跳的时候, 再将数据进行同步.</p><p>如果Follower超前了, Follower会将他的数据删除, 保持logEntries和Leader的一致.</p><h4 id="committed"><a class="anchorlink" href="#committed">3.3 Committed</a></h4><p>论文原文摘录:</p>
<blockquote>
<p>A log entry is committed once the leader that created the entry has replicated it on a majority of the servers (e.g., entry 7). This also <strong>commits all preceding entries</strong> in the leader’s log, including entries created by previous leaders</p>
</blockquote>
<div class="note"><p>一旦 <code>term</code> 和 <code>maxIndex</code> 是一致的, 则最终的结果就是一致的, 存储的命令也是一致的</p></div><p>可以证明, 所有已经commited 的 entry, 在所有的机器上是一致的.</p><h3 id="cluster-memeber-changed"><a class="anchorlink" href="#cluster-memeber-changed">4 Cluster Memeber Changed</a></h3><p>这一部分讨论的问题是 <strong>如何扩容</strong> 的问题</p><h4 id="joint-consensus"><a class="anchorlink" href="#joint-consensus">4.1 Joint Consensus</a></h4><div class="todo"><p>这部分不是很理解</p></div><h3 id="client-interaction"><a class="anchorlink" href="#client-interaction">5 Client Interaction</a></h3><p>客户端会随机向某一台服务器发送请求, 如果服务器不是leader的话, 它会拒绝这个请求并
告知最新的leader的地址</p><h3 id="references"><a class="anchorlink" href="#references">6 References</a></h3>
<ul>
<li><a href="https://raft.github.io">Raft</a></li>
<li><a href="http://thesecretlivesofdata.com/raft/">Raft Live</a></li>
<li><a href="https://www.cl.cam.ac.uk/~ms705/pub/papers/2015-osr-raft.pdf">Raft Refloated: Do We Have Consensus?</a></li>
<li><a href="https://raft.github.io/raft.pdf">In Search of an Understandable Consensus Algorithm</a></li>
</ul>


        <div id="comment"></div>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>版权声明：自由转载-非商用-非衍生-保持署名(<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">创意共享3.0许可证</a>)</p>
<p>
  <a href="https://github.com/996icu/996.ICU/blob/master/LICENSE"><img src="https://img.shields.io/badge/license-Anti%20996-blue.svg" /></a>
</p>

    </div>
  </div>

  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/acoustic_grand_piano-ogg.js"></script>

  <!-- ./node_modules/gulp/bin/gulp.js build -\-brushes=bash,cpp,css,javascript,java,plain,python,ruby,scala,sql,xml -->
  <!-- uglifyjs syntaxhighlighter.js  -\-output syntaxhighlighter.min.js -->
  <script type="text/javascript" src="javascripts/syntaxhighlighter.min.js"></script>
  <script type="text/javascript" src="javascripts/tonal.min.js"></script>
  <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tone/13.0.1/Tone.min.js"></script> -->
  <script type="text/javascript" src="javascripts/Tone.min.js"></script>
  <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.6.4/svg.min.js"></script> -->
  <script type="text/javascript" src="javascripts/svg.min.js"></script>
  <script type="text/javascript" src="javascripts/chordy-svg.min.js"></script>
  <script type="text/javascript" src="javascripts/chord.js"></script>
  <!-- <script type="text/javascript" src="javascripts/gitalk.min.js"></script> -->
  <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.2.2/gitalk.min.js"></script> -->
  <script type="text/javascript" src="javascripts/gitalk.min.js"></script>
  <script type="text/javascript" src="javascripts/load_docs.js"></script>
  <script type="text/javascript" src="javascripts/Treant.js"></script>
  <!-- <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.0/raphael&#45;min.js"></script> -->
  <script type="text/javascript" src="javascripts/raphael.min.js"></script>
  <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.11.0/flowchart.min.js"></script> -->
  <script type="text/javascript" src="javascripts/flowchart.min.js"></script>
  <script type="text/javascript" src="javascripts/flowchart_generator.js"></script>
  <script type="text/javascript" src="javascripts/tree_generator.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-115746206-1"></script>

  <script type="text/javascript" src="javascripts/abcjs_midi_5.1.2-min.js"></script>
  <script type="text/javascript" src="javascripts/music_generator.js"></script>

  <script type="text/javascript">
    syntaxhighlighterConfig = {
      autoLinks: false,
    };

    $(guidesIndex.bind);

    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-115746206-1');
  </script>

  <script type="text/javascript">
    var locationId = (location.pathname).split("/").pop().substring(0, 49);

    if (locationId) {
      var language = window.location.search.match("lang=en") ? "en" : "zh-CN"

      if (window.location.href.match("github")) {
        var gitalk = new Gitalk({
          clientID: '85c5f833b04d6d470db9',
          clientSecret: 'b41619fc891132558550103056197eb30baebab5',
          repo: 'blog-github-page-comments',
          owner: 'dengqinghua',
          admin: ['dengqinghua'],
          id: locationId,
          distractionFreeMode: true,
          language: language
        });
      } else {
        var gitalk = new Gitalk({
          clientID: '0f5824fe1c09851e9781',
          clientSecret: '61710a77ee98cddce06f408a398f05c8622e9575',
          repo: 'blog_comments',
          owner: 'dengqinghua',
          admin: ['dengqinghua'],
          id: locationId,
          distractionFreeMode: true,
          language: language
        });
      }

      gitalk.render('comment');
    }
  </script>
</body>
</html>
