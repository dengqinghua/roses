<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="baidu-site-verification" content="N1Q3HiESgp" />

<title>Docker Learning — dengqinghua&#39;s blog</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/abcjs-midi.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/gitalk.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/Treant.css" />
  <link href="images/favicon.jpeg" rel="shortcut icon" type="image/x-icon" />
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body class="guide">
  <div id="topNav">
    <div class="wrapper">

      <strong class="more-info-label">More:</strong>

      <span class="red-button more-info-button">More Dengqinghua</span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://dengqinghua.github.io/about_me.html">About me</a></li>
        <li class="more-info"><a href="https://github.com/dengqinghua/">Github</a></li>
        <li class="more-info"><a href="mailto:dengqinghua.42@gmail.com">Gmail</a></li>
        <li class="more-info"><a href="https://twitter.com/dengqinghua_42">Twitter</a></li>
      </ul>

      <form action="https://google.com/search" method="get">
          <input name="q" value="site:dengqinghua.github.io" type="hidden">
          <input class="search" name="q" placeholder="Search Blog" type="text">
      </form>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="http://dengqinghua.github.io" title="Return to home page">http://dengqinghua.github.io</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="http://dengqinghua.github.io">Home</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">
            Index <span id="guidesArrow">▸</span>
          </a>

          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>推荐</dt>
                <dd><a href="badge_system.html">基于内存数据库的角标系统设计</a></dd>
                <dd><a href="witness_flow.html">业务流引擎系统</a></dd>
                <dt>Ruby</dt>
                <dd><a href="ruby_knowledge_tree.html">Ruby知识树</a></dd>
                <dd><a href="ruby_model.html">Ruby数据模型</a></dd>
                <dd><a href="arel.html?lang=en">Arel源码分析</a></dd>
                <dd><a href="sidekiq_task_event.html">基于Sidekiq的异步任务管理引擎</a></dd>
                <dd><a href="racc.html">Racc</a></dd>
                <dd><a href="witness_flow.html">业务流引擎系统</a></dd>
                <dt>Java</dt>
                <dd><a href="data_structures.html">数据结构</a></dd>
                <dd><a href="learn_jvm.html">JVM剖析</a></dd>
                <dd><a href="concurrency.html">Concurrency</a></dd>
                <dd><a href="badge_system.html">基于内存数据库的角标系统设计</a></dd>
                <dd><a href="maven_under_command_line.html">命令行下的Maven</a></dd>
                <dt>MySQL</dt>
                <dd><a href="mysql_knowledge_tree.html">MySQL知识树</a></dd>
              </dl>
              <dl class="R">
                <dt>Go</dt>
                <dd><a href="go_get_timeout_solution.html">GoInstallBinaries i/o timeout问题</a></dd>
                <dd><a href="go_knowledge_tree.html">Go知识树</a></dd>
                <dt>音乐</dt>
                <dd><a href="music_index.html">音乐学习体系</a></dd>
                <dd><a href="lalaland-city_of_stars.html">City Of Star</a></dd>
                <dd><a href="あの日の帰り道.html">あの日の帰り道</a></dd>
                <dd><a href="rain_wwh.html">雨の日はワルツを踊って</a></dd>
                <dd><a href="moon_river.html">Moon River</a></dd>
                <dd><a href="it_could_have_been.html">Es Ware Schon Gewesen</a></dd>
                <dt>杂记</dt>
                <dd><a href="example_markdown.html">markdown格式实例</a></dd>
                <dd><a href="comments.html">注释规范</a></dd>
                <dd><a href="best_programming.html">零bug落地方案</a></dd>
                <dd><a href="raft.html">Raft算法</a></dd>
                <dd><a href="memorize_my_mentor.html">Memorize My Mentor</a></dd>
              </dl>
          </div>
        </li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">Index</option>
              <optgroup label="推荐">
                  <option value="badge_system.html">基于内存数据库的角标系统设计</option>
                  <option value="witness_flow.html">业务流引擎系统</option>
              </optgroup>
              <optgroup label="Ruby">
                  <option value="ruby_knowledge_tree.html">Ruby知识树</option>
                  <option value="ruby_model.html">Ruby数据模型</option>
                  <option value="arel.html?lang=en">Arel源码分析</option>
                  <option value="sidekiq_task_event.html">基于Sidekiq的异步任务管理引擎</option>
                  <option value="racc.html">Racc</option>
                  <option value="witness_flow.html">业务流引擎系统</option>
              </optgroup>
              <optgroup label="Java">
                  <option value="data_structures.html">数据结构</option>
                  <option value="learn_jvm.html">JVM剖析</option>
                  <option value="concurrency.html">Concurrency</option>
                  <option value="badge_system.html">基于内存数据库的角标系统设计</option>
                  <option value="maven_under_command_line.html">命令行下的Maven</option>
              </optgroup>
              <optgroup label="MySQL">
                  <option value="mysql_knowledge_tree.html">MySQL知识树</option>
              </optgroup>
              <optgroup label="Go">
                  <option value="go_get_timeout_solution.html">GoInstallBinaries i/o timeout问题</option>
                  <option value="go_knowledge_tree.html">Go知识树</option>
              </optgroup>
              <optgroup label="音乐">
                  <option value="music_index.html">音乐学习体系</option>
                  <option value="lalaland-city_of_stars.html">City Of Star</option>
                  <option value="あの日の帰り道.html">あの日の帰り道</option>
                  <option value="rain_wwh.html">雨の日はワルツを踊って</option>
                  <option value="moon_river.html">Moon River</option>
                  <option value="it_could_have_been.html">Es Ware Schon Gewesen</option>
              </optgroup>
              <optgroup label="杂记">
                  <option value="example_markdown.html">markdown格式实例</option>
                  <option value="comments.html">注释规范</option>
                  <option value="best_programming.html">零bug落地方案</option>
                  <option value="raft.html">Raft算法</option>
                  <option value="memorize_my_mentor.html">Memorize My Mentor</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Docker Learning</h2><div class="date"><p>2019-04-09</p></div><p>该文档涵盖了 Docker 的一些学习笔记.</p><p>阅读完该文档之后, 您将了解到:</p>
<ul>
<li>Docker 架构.</li>
<li>Docker 使用</li>
<li>Docker 的源码分析和架构思考.</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li>
<a href="#%E6%9E%B6%E6%9E%84">架构</a>

<ul>
<li><a href="#componets">Componets</a></li>
<li><a href="#key-technical-components">Key Technical Components</a></li>
</ul>
</li>
<li>
<a href="#%E4%BA%A4%E4%BA%92">交互</a>

<ul>
<li><a href="#%E5%90%AF%E5%8A%A8-%E7%9B%91%E6%8E%A7%E5%92%8C%E7%BB%9F%E8%AE%A1">启动, 监控和统计</a></li>
<li><a href="#%E6%90%9C%E7%B4%A2-%E6%8B%89%E5%8F%96%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89-images">搜索, 拉取和自定义 images</a></li>
<li><a href="#%E8%BF%9B%E5%85%A5%E6%9F%90%E4%B8%AAdocker">进入某个docker</a></li>
</ul>
</li>
<li>
<a href="#docker%E9%9C%80%E8%A6%81%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98">Docker需要解决的问题</a>

<ul>
<li><a href="#cmd-%E5%92%8C-entrypoint">CMD 和 ENTRYPOINT</a></li>
</ul>
</li>
<li>
<a href="#network-interface">Network Interface</a>

<ul>
<li><a href="#docker-internal-networking">docker internal networking</a></li>
</ul>
</li>
<li>
<a href="#volume">Volume</a>

<ul>
<li><a href="#docker-volume">docker volume</a></li>
</ul>
</li>
<li>
<a href="#%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92-%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E5%92%8C%E9%9B%86%E7%BE%A4">容器编排,服务发现和集群</a>

<ul>
<li><a href="#%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92-dockercompose">容器编排 DockerCompose</a></li>
<li><a href="#%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0-consul">服务发现 Consul</a></li>
<li><a href="#%E9%9B%86%E7%BE%A4-swarm">集群 Swarm</a></li>
</ul>
</li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="架构"><a class="anchorlink" href="#%E6%9E%B6%E6%9E%84">1 架构</a></h3><h4 id="componets"><a class="anchorlink" href="#componets">1.1 Componets</a></h4><div class="tree_chart" style="display:none" id="acd26054b055a5bc5313dd82001b023d">
  {"chart":{"container":"#acd26054b055a5bc5313dd82001b023d","rootOrientation":"WEST","siblingSeparation":40,"subTeeSeparation":30,"connectors":{"type":"step","style":{"stroke":"#bbb","arrow-end":"block-wide-long"}},"node":{"HTMLclass":"nodeChart"}},"nodeStructure":{"text":{"name":"Docker"},"children":[{"text":{"name":"Engine: Client and Server"}},{"text":{"name":"Images"}},{"text":{"name":"Registers"}},{"text":{"name":"Containers"}}]}}
</div>
<h4 id="key-technical-components"><a class="anchorlink" href="#key-technical-components">1.2 Key Technical Components</a></h4>
<ul>
<li>libcontainer</li>
<li>Linux Kernel namespaces</li>
<li>Isolation

<ul>
<li>Filesystem</li>
<li>Process</li>
<li>Network</li>
</ul>
</li>
<li>Resource Isolation and Grouping</li>
<li>Copy on Write of filesystem</li>
<li>Logging from STDIN, STDOUT and STDERR of container</li>
<li>Interactive Shell</li>
</ul>
<h3 id="交互"><a class="anchorlink" href="#%E4%BA%A4%E4%BA%92">2 交互</a></h3><h4 id="启动-监控和统计"><a class="anchorlink" href="#%E5%90%AF%E5%8A%A8-%E7%9B%91%E6%8E%A7%E5%92%8C%E7%BB%9F%E8%AE%A1">2.1 启动, 监控和统计</a></h4><div class="info"><p>下面的 <code>guides</code> 均为 container_name</p></div><div class="code_container">
<pre class="brush: bash; gutter: false; toolbar: true;">
docker run --name guides -i -t ubuntu /bin/bash

</pre>
</div>
<div class="code_container">
<pre class="brush: bash; gutter: false; toolbar: true;">
docker start/stop guides
docker attach guides # 进入容器

</pre>
</div>
<p>监控和统计</p><div class="code_container">
<pre class="brush: bash; gutter: false; toolbar: true;">
docker top guides
docker stats

</pre>
</div>
<div class="info"><p>i: interactive, t: pseudo-tty</p></div><div class="note"><p>docker run 的运行方式是什么样的? 如果生成多个 container 的时候, 会占用多少容量呢?</p></div><h4 id="搜索-拉取和自定义-images"><a class="anchorlink" href="#%E6%90%9C%E7%B4%A2-%E6%8B%89%E5%8F%96%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89-images">2.2 搜索, 拉取和自定义 images</a></h4><div class="code_container">
<pre class="brush: bash; gutter: false; toolbar: true;">
docker search ruby

# NAME DESCRIPTION       STARS OFFICIAL AUTOMATED
# ruby Ruby is a dynamic 1648  [OK]

docker pull ruby

</pre>
</div>
<h5 id="dockerfile"><a class="anchorlink" href="#dockerfile">2.2.1 Dockerfile</a></h5><div class="note"><p>相关命令见<a href="https://docs.docker.com/engine/reference/builder/">这里</a></p></div><div class="code_container">
<pre class="brush: bash; gutter: false; toolbar: true;">
# Version: 0.0.1
FROM ubuntu:16.04
MAINTAINER dengqinghua "dengqinghua.42@gmail.com"
RUN apt-get update; apt-get install -y nginx
RUN echo "Hi, I am in your container" &gt; /var/www/html/index.html
EXPOSE 80

</pre>
</div>
<p>从当前目录构建新的镜像</p><div class="code_container">
<pre class="brush: bash; gutter: false; toolbar: true;">
docker build -t="dengqinghua/static_web:v1" .

</pre>
</div>
<div class="info"><p>-t tag</p></div><div class="note"><p><del>在mac上, docker 基于 virtualbox, 需要先生成一个本地的VM</del></p></div><h5 id="ip和端口的映射关系"><a class="anchorlink" href="#ip%E5%92%8C%E7%AB%AF%E5%8F%A3%E7%9A%84%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB">2.2.2 IP和端口的映射关系</a></h5><div class="note"><p>如果使用的 <code>virtualbox</code> 作为 VM, 通过 <code>docker-machine ls</code>, 可以看到绑定的地址</p></div><div class="code_container">
<pre class="brush: bash; gutter: false; toolbar: true;">
docker-machine ls
NAME      ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER     ERRORS
default   *        virtualbox   Running   tcp://192.168.99.106:2376           v18.09.3

</pre>
</div>
<p>可以看到 docker 在本机的地址为 <code>192.168.99.106</code></p><p>当我们执行 docker run , 并且想暴露端口时候, 可以添加 <code>-p</code> 参数, 如</p><div class="code_container">
<pre class="brush: bash; gutter: false; toolbar: true;">
docker run -d -p 80 --name static_web dengqinghua/static_web:v2 nginx

</pre>
</div>
<p>可以通过 <code>docker ps -l</code> 看到绑定关系</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: true;">
docker ps -l

CONTAINER ID        IMAGE                       COMMAND  PORTS                   NAMES
3417f368d461        dengqinghua/static_web:v2   "nginx"  0.0.0.0:32777-&gt;80/tcp   static_web

</pre>
</div>
<p>可以看到 IP和端口的绑定关系:</p><p>Docker     0.0.0.0:32777
Container  80</p><p>而结合docker在本机的地址为 192.168.99.106:32777</p><p>则在浏览器访问 192.168.99.106:32777, 则可以访问到 nginx 的静态index文件</p><h4 id="进入某个docker"><a class="anchorlink" href="#%E8%BF%9B%E5%85%A5%E6%9F%90%E4%B8%AAdocker">2.3 进入某个docker</a></h4><div class="code_container">
<pre class="brush: bash; gutter: false; toolbar: true;">
docker exec -it container_name bash

-i, --interactive   Keep STDIN open even if not attached
    --privileged    Give extended privileges to the command
-t, --tty           Allocate a pseudo-TTY

</pre>
</div>
<h3 id="docker需要解决的问题"><a class="anchorlink" href="#docker%E9%9C%80%E8%A6%81%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98">3 Docker需要解决的问题</a></h3>
<ol>
<li>隔离, 分配不同的用户权限</li>
<li>文件的共享, 一些数据是不能在 Dockerfile 里面的, 如数据, 代码等</li>
<li>环境变量, 参数设置(如 http_proxy)</li>
<li>基础组件的安装, 前置/后置命令的执行 (ON/BEFORE/AFTER BUILD)</li>
<li>和docker的通信(信号量等), 端口暴露和端口映射</li>
<li>自动化, AutoBuild/CI 等</li>
<li>端口的映射</li>
</ol>
<h4 id="cmd-和-entrypoint"><a class="anchorlink" href="#cmd-%E5%92%8C-entrypoint">3.1 CMD 和 ENTRYPOINT</a></h4><p>CMD: 为 container 启动之后, 执行的命令, 可以被命令行<code>docker run</code>覆盖, 在 Dockerfile 中仅能申明一个 CMD 指令
ENTRYPOINT: The ENTRYPOINT instruction provides a command that isn’t as easily overridden.</p><h3 id="network-interface"><a class="anchorlink" href="#network-interface">4 Network Interface</a></h3><h4 id="docker-internal-networking"><a class="anchorlink" href="#docker-internal-networking">4.1 docker internal networking</a></h4><p>docker container生成的时候, 均会接口(interface0)分配对应的IP地址, 网段为 <code>172.17-172.30</code></p><h3 id="volume"><a class="anchorlink" href="#volume">5 Volume</a></h3><h4 id="docker-volume"><a class="anchorlink" href="#docker-volume">5.1 docker volume</a></h4><p>volume 可以认为是docker的持久化文件机制</p><p>通过</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: true;">
docker volume ls

</pre>
</div>
<p>可以看到当前的目录</p><div class="code_container">
<pre class="brush: bash; gutter: false; toolbar: true;">
docker volume ls

DRIVER              VOLUME NAME
local               4f80cc3ae270bf3c82abab71548bb1eaba8a0b2f7305e9ea862d5c96b1409009
local               5f1f3a638561b6ade35715fb320ce32dd96e86326cf85fd93e1b452350ccafb6
local               9d49d86bca227497d834a097dc08c972238ab4c8fc426f9889a03b500c3de470
local               33c3f1acba2d22e340f8bc24913a8a4501b689ee4f800f93d1d1e4e155356f1f
local               43b47ab7587f536bcc922eb5d8fa43d0075eb7d9e7e4648b395c89fd201f9d9c
local               5829ba6a91108cddaddd821e72edd7f9f0dc131ce25eafa9ddb72cf790a279af
local               6412489d1e1bff99a4b28f3c4fd6d7789724c5a0909a63ecc3d2fce51e9631f6
local               eefedf7a7e4aa781344c5dc40625fc813883a1ea73936461c54a1f0f39f4980c
local               f39f79523354563e72774100583c070a8077766b6ed4134995c7a468d77555a6

</pre>
</div>
<p>我们可以看到每一个 VOLUME 对应的本机的文件目录地址</p><div class="code_container">
<pre class="brush: bash; gutter: false; toolbar: true;">
docker volume inspect 4f80cc3ae270bf3c82abab71548bb1eaba8a0b2f7305e9ea862d5c96b1409009

[
    {
        "CreatedAt": "2019-05-12T08:16:36Z",
        "Driver": "local",
        "Labels": null,
        "Mountpoint": "/var/lib/docker/volumes/4f80cc3ae270bf3c82abab71548bb1eaba8a0b2f7305e9ea862d5c96b1409009/_data",
        "Name": "4f80cc3ae270bf3c82abab71548bb1eaba8a0b2f7305e9ea862d5c96b1409009",
        "Options": null,
        "Scope": "local"
    }
]

</pre>
</div>
<p>这里 <code>"Mountpoint": "/var/lib/docker/volumes/4f80cc3ae270bf3c82abab71548bb1eaba8a0b2f7305e9ea862d5c96b1409009/_data"</code> 为本机的目录</p><div class="note"><p>如果您用的是 MacOS, 上面的目录是无法打开的, 因为docker在mac中, 是通过 VM实现的. 需要先进入VM, 再进去上述的地址. 进入 VM 的方式跟您的 Mac 版本和 Docker 的版本相关. 我的方式为 <code>screen ~/Library/Containers/com.docker.docker/Data/vms/0/tty</code>, 参考 StackOverflow 的这篇文章 <a href="https://stackoverflow.com/q/38532483">Where is /var/lib/docker on Mac/OS X</a></p></div><h3 id="容器编排-服务发现和集群"><a class="anchorlink" href="#%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92-%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E5%92%8C%E9%9B%86%E7%BE%A4">6 容器编排,服务发现和集群</a></h3><h4 id="容器编排-dockercompose"><a class="anchorlink" href="#%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92-dockercompose">6.1 容器编排 DockerCompose</a></h4><h4 id="服务发现-consul"><a class="anchorlink" href="#%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0-consul">6.2 服务发现 Consul</a></h4><h4 id="集群-swarm"><a class="anchorlink" href="#%E9%9B%86%E7%BE%A4-swarm">6.3 集群 Swarm</a></h4>

        <div id="comment"></div>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>版权声明：自由转载-非商用-非衍生-保持署名(<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">创意共享3.0许可证</a>)</p>
<p>
  <a href="https://github.com/996icu/996.ICU/blob/master/LICENSE"><img src="https://img.shields.io/badge/license-Anti%20996-blue.svg" /></a>
</p>

    </div>
  </div>

  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/acoustic_grand_piano-ogg.js"></script>

  <!-- ./node_modules/gulp/bin/gulp.js build -\-brushes=bash,cpp,css,javascript,java,plain,python,ruby,scala,sql,xml -->
  <!-- uglifyjs syntaxhighlighter.js  -\-output syntaxhighlighter.min.js -->
  <script type="text/javascript" src="javascripts/syntaxhighlighter.min.js"></script>
  <script type="text/javascript" src="javascripts/tonal.min.js"></script>
  <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tone/13.0.1/Tone.min.js"></script> -->
  <script type="text/javascript" src="javascripts/Tone.min.js"></script>
  <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.6.4/svg.min.js"></script> -->
  <script type="text/javascript" src="javascripts/svg.min.js"></script>
  <script type="text/javascript" src="javascripts/chordy-svg.min.js"></script>
  <script type="text/javascript" src="javascripts/chord.js"></script>
  <!-- <script type="text/javascript" src="javascripts/gitalk.min.js"></script> -->
  <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.2.2/gitalk.min.js"></script> -->
  <script type="text/javascript" src="javascripts/gitalk.min.js"></script>
  <script type="text/javascript" src="javascripts/load_docs.js"></script>
  <script type="text/javascript" src="javascripts/Treant.js"></script>
  <!-- <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.0/raphael&#45;min.js"></script> -->
  <script type="text/javascript" src="javascripts/raphael.min.js"></script>
  <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.11.0/flowchart.min.js"></script> -->
  <script type="text/javascript" src="javascripts/flowchart.min.js"></script>
  <script type="text/javascript" src="javascripts/flowchart_generator.js"></script>
  <script type="text/javascript" src="javascripts/tree_generator.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-115746206-1"></script>

  <script type="text/javascript" src="javascripts/abcjs_midi_5.1.2-min.js"></script>
  <script type="text/javascript" src="javascripts/music_generator.js"></script>

  <script type="text/javascript">
    syntaxhighlighterConfig = {
      autoLinks: false,
    };

    $(guidesIndex.bind);

    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-115746206-1');
  </script>

  <script type="text/javascript">
    var locationId = (location.pathname).split("/").pop().substring(0, 49);

    if (locationId) {
      var language = window.location.search.match("lang=en") ? "en" : "zh-CN"

      if (window.location.href.match("github")) {
        var gitalk = new Gitalk({
          clientID: '85c5f833b04d6d470db9',
          clientSecret: 'b41619fc891132558550103056197eb30baebab5',
          repo: 'blog-github-page-comments',
          owner: 'dengqinghua',
          admin: ['dengqinghua'],
          id: locationId,
          distractionFreeMode: true,
          language: language
        });
      } else {
        var gitalk = new Gitalk({
          clientID: '0f5824fe1c09851e9781',
          clientSecret: '61710a77ee98cddce06f408a398f05c8622e9575',
          repo: 'blog_comments',
          owner: 'dengqinghua',
          admin: ['dengqinghua'],
          id: locationId,
          distractionFreeMode: true,
          language: language
        });
      }

      gitalk.render('comment');
    }
  </script>
</body>
</html>
