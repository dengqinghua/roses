<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="baidu-site-verification" content="N1Q3HiESgp" />

<title>Spring — dengqinghua&#39;s blog</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/abcjs-midi.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/gitalk.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/asciinema-player.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/Treant.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/zoom.css" />
  <link href="images/favicon.jpeg" rel="shortcut icon" type="image/x-icon" />
  <link rel="stylesheet" type="text/css" href="stylesheets/font-awesome.min.css" />
</head>
<body class="guide">
  <div id="topNav">
    <div class="wrapper">

      <strong class="more-info-label">More:</strong>

      <span class="red-button more-info-button">More Dengqinghua</span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://www.dengqinghua.net">About me</a></li>
        <li class="more-info"><a href="https://github.com/dengqinghua/">Github</a></li>
        <li class="more-info"><a href="mailto:dengqinghua.42@gmail.com">Gmail</a></li>
        <li class="more-info"><a href="https://twitter.com/dengqinghua_42">Twitter</a></li>
      </ul>

      <form action="https://google.com/search" method="get">
          <input name="q" value="site:dengqinghua.net" type="hidden">
          <input class="search" name="q" placeholder="Search Blog" type="text">
      </form>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="https://blog.dengqinghua.net" title="Return to home page">http://blog.dengqinghua.net</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="https://blog.dengqinghua.net">Home</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">
            Index <span id="guidesArrow">▸</span>
          </a>

          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>2019年</dt>
                <dd><a href="badge_system.html">基于内存数据库的角标系统设计</a></dd>
                <dd><a href="witness_flow.html">业务流引擎系统</a></dd>
                <dt>2018年</dt>
                <dd><a href="ruby_knowledge_tree.html">Ruby知识树</a></dd>
                <dd><a href="ruby_model.html">Ruby数据模型</a></dd>
                <dd><a href="arel.html?lang=en">Arel源码分析</a></dd>
                <dd><a href="sidekiq_task_event.html">基于Sidekiq的异步任务管理引擎</a></dd>
                <dd><a href="racc.html">Racc</a></dd>
                <dd><a href="witness_flow.html">业务流引擎系统</a></dd>
                <dd><a href="data_structures.html">数据结构</a></dd>
                <dd><a href="learn_jvm.html">JVM剖析</a></dd>
                <dd><a href="concurrency.html">Concurrency</a></dd>
                <dd><a href="badge_system.html">基于内存数据库的角标系统设计</a></dd>
                <dd><a href="maven_under_command_line.html">命令行下的Maven</a></dd>
                <dd><a href="mysql_knowledge_tree.html">MySQL知识树</a></dd>
                <dd><a href="go_knowledge_tree.html">Go知识树</a></dd>
                <dd><a href="music_index.html">音乐学习体系</a></dd>
                <dd><a href="songbooks.html">曲谱集</a></dd>
                <dd><a href="my_creatives.html">作品集</a></dd>
                <dd><a href="example_markdown.html">markdown格式实例</a></dd>
                <dd><a href="comments.html">注释规范</a></dd>
                <dd><a href="best_programming.html">零bug落地方案</a></dd>
                <dd><a href="raft.html">Raft算法</a></dd>
                <dd><a href="memorize_my_mentor.html">Memorize My Mentor</a></dd>
              </dl>
              <dl class="R">
              </dl>
          </div>
        </li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">Index</option>
              <optgroup label="2019年">
                  <option value="badge_system.html">基于内存数据库的角标系统设计</option>
                  <option value="witness_flow.html">业务流引擎系统</option>
              </optgroup>
              <optgroup label="2018年">
                  <option value="ruby_knowledge_tree.html">Ruby知识树</option>
                  <option value="ruby_model.html">Ruby数据模型</option>
                  <option value="arel.html?lang=en">Arel源码分析</option>
                  <option value="sidekiq_task_event.html">基于Sidekiq的异步任务管理引擎</option>
                  <option value="racc.html">Racc</option>
                  <option value="witness_flow.html">业务流引擎系统</option>
                  <option value="data_structures.html">数据结构</option>
                  <option value="learn_jvm.html">JVM剖析</option>
                  <option value="concurrency.html">Concurrency</option>
                  <option value="badge_system.html">基于内存数据库的角标系统设计</option>
                  <option value="maven_under_command_line.html">命令行下的Maven</option>
                  <option value="mysql_knowledge_tree.html">MySQL知识树</option>
                  <option value="go_knowledge_tree.html">Go知识树</option>
                  <option value="music_index.html">音乐学习体系</option>
                  <option value="songbooks.html">曲谱集</option>
                  <option value="my_creatives.html">作品集</option>
                  <option value="example_markdown.html">markdown格式实例</option>
                  <option value="comments.html">注释规范</option>
                  <option value="best_programming.html">零bug落地方案</option>
                  <option value="raft.html">Raft算法</option>
                  <option value="memorize_my_mentor.html">Memorize My Mentor</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Spring</h2><div class="date"><p>2020-03-19</p></div><p>该文档涵盖了 Spring 的基本概念 和 核心代码 分析</p><p>阅读完该文档后，您将会了解到:</p>
<ul>
<li>Spring 的核心概念</li>
<li>Bean 的生命周期</li>
<li>Spring 全家桶</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li>
<a href="#%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5">重要概念</a>

<ul>
<li><a href="#ioc">IoC</a></li>
<li><a href="#di">DI</a></li>
<li><a href="#aop">AOP</a></li>
<li><a href="#container">Container</a></li>
</ul>
</li>
<li>
<a href="#bean">Bean</a>

<ul>
<li><a href="#scope">Scope</a></li>
<li><a href="#%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98">三级缓存</a></li>
</ul>
</li>
<li><a href="#event">Event</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="重要概念"><a class="anchorlink" href="#%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5">1 重要概念</a></h3><h4 id="ioc"><a class="anchorlink" href="#ioc">1.1 IoC</a></h4><p>Ioc, <code>Inversion of Control</code>, 控制权反转，即： 将 对象的控制权，交由给第三方处理。在 Spring 上下文中，这个第三方就是 容器【Container】。控制权反转之后，创建对象将由容器来完成</p><h4 id="di"><a class="anchorlink" href="#di">1.2 DI</a></h4><p>DI, <code>Dependency Injection</code>, 依赖注入, 即: 在进行 IOC 之后，需要管理对象之前的依赖关系。一般来说，对象之间的依赖关系是在 RUNTIME 决定的，依赖注入做的事情就是管理和校验依赖关系，提高组件的效率</p><div class="note"><p><strong>IOC 和 Factory</strong>:
IOC 为 push 机制，依赖于 配置，在一个地方配置所有的组件。Factory 为 pull, 类之间的依赖需要依赖 Factory Method，实现需要各种类.
使用 Factory 模式，则主要责任是在于 类 本身，而 IOC 则是将 责任外包出去，由框架去组装对象的生成</p></div><h4 id="aop"><a class="anchorlink" href="#aop">1.3 AOP</a></h4><p>AOP, <code>Aspect oriented programming</code>, DI 解决的是依赖之间的解耦, 而 AOP 是行为之间的解耦. 在 Spring 中, 是以拦截器(interceptors)的方式
来做对应的 AOP. 经常使用的 interceptors 有 Loggers, Transactions, security, cache 等等</p><div class="note"><p>在 Ruby on Rails 中, AOP 的实现是以 Callback 的形式呈现的</p></div>
<blockquote>
<p>DI helps you decouple your application objects from it’s dependencies,
while AOP helps you decouple cross-cutting concerns from the objects.</p>
</blockquote>
<h4 id="container"><a class="anchorlink" href="#container">1.4 Container</a></h4>
<ul>
<li>BeanFactory Container</li>
<li>ApplicationContext Container</li>
</ul>
<div class="note"><p>元数据 + Beans -&gt; 容器 = 一个启动的应用程序</p></div><h3 id="bean"><a class="anchorlink" href="#bean">2 Bean</a></h3><h4 id="scope"><a class="anchorlink" href="#scope">2.1 Scope</a></h4>
<ul>
<li>singletion 默认</li>
<li>prototype 每次都创建新的 bean</li>
<li>request, session 和 global-session 和网络请求相关的 bean 的作用域</li>
</ul>
<h4 id="三级缓存"><a class="anchorlink" href="#%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98">2.2 三级缓存</a></h4>
<table>
<thead>
<tr>
<th>Name</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>singletonObjects【一级缓存】</td>
<td>已经初始化完成的 Bean 对象</td>
</tr>
<tr>
<td>earlySingletonObjects【二级缓存】</td>
<td>已经初始化但是未初始化好的 Bean 对象</td>
</tr>
<tr>
<td>singletonFactories【三级缓存】</td>
<td>存放工厂对象</td>
</tr>
</tbody>
</table>
<p>见 <a href="https://github.com/spring-projects/spring-framework/blob/8f369ffed55dad6021624105b961884c2e42d605/spring-beans/src/main/java/org/springframework/beans/factory/support/DefaultSingletonBeanRegistry.java#L180">源码</a></p><p>查询方式: 先在 singletonObjects 找, 再去 earlySingletonObjects 找, 最后去 singletonFactories 找, 通过这种方式解决了 <strong>循环依赖</strong> 的问题</p><div class="info"><p>理论上是不应该支持 <code>循环依赖</code> 的功能的, 如果是直接得循环依赖，而且实时创建依赖的 Bean, 则会[报错], 但是 Spring 支持了其他方式，所以才出现了这样的设计</p></div><div class="code_container">
<pre class="brush: java; gutter: false; toolbar: true;">
protected Object getSingleton(String beanName, boolean allowEarlyReference) {
  Object singletonObject = this.singletonObjects.get(beanName);
  if (singletonObject == null &amp;&amp; isSingletonCurrentlyInCreation(beanName)) {
    synchronized (this.singletonObjects) {
      singletonObject = this.earlySingletonObjects.get(beanName);
      if (singletonObject == null &amp;&amp; allowEarlyReference) {
        ObjectFactory&lt;?&gt; singletonFactory = this.singletonFactories.get(beanName);
        if (singletonFactory != null) {
          singletonObject = singletonFactory.getObject();
          this.earlySingletonObjects.put(beanName, singletonObject);
          this.singletonFactories.remove(beanName);
        }
      }
    }
  }
  return singletonObject;
}

</pre>
</div>
<h3 id="event"><a class="anchorlink" href="#event">3 Event</a></h3><p>ApplicationContext 管理着 Bean 的生命周期, 当一些 bean 发生变化的时候，会通过 Event 的形式发布消息</p>
<blockquote>
<p>By default spring events are synchronous,
the <code>doStuffAndPublishAnEvent()</code> method blocks
until all listeners finish processing the event.</p>
</blockquote>


        <div id="comment"></div>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>版权声明：自由转载-非商用-非衍生-保持署名(<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">创意共享3.0许可证</a>)</p>
<p>
  <a href="https://github.com/996icu/996.ICU/blob/master/LICENSE"><img src="images/license-Anti996-blue.svg" /></a>
</p>

    </div>
  </div>

  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/acoustic_grand_piano-ogg.js"></script>

  <!-- ./node_modules/gulp/bin/gulp.js build -\-brushes=bash,cpp,css,javascript,java,plain,python,ruby,scala,sql,xml -->
  <!-- uglifyjs syntaxhighlighter.js  -\-output syntaxhighlighter.min.js -->
  <script type="text/javascript" src="javascripts/syntaxhighlighter.min.js"></script>
  <script type="text/javascript" src="javascripts/tonal.min.js"></script>
  <script type="text/javascript" src="javascripts/Tone.min.js"></script>
  <script type="text/javascript" src="javascripts/svg.min.js"></script>
  <script type="text/javascript" src="javascripts/chordy-svg.min.js"></script>
  <script type="text/javascript" src="javascripts/chord.js"></script>
  <script type="text/javascript" src="javascripts/gitalk.min.js"></script>
  <script type="text/javascript" src="javascripts/load_docs.js"></script>
  <script type="text/javascript" src="javascripts/asciinema-player.js"></script>
  <script type="text/javascript" src="javascripts/Treant.js"></script>
  <script type="text/javascript" src="javascripts/raphael.min.js"></script>
  <script type="text/javascript" src="javascripts/flowchart.min.js"></script>
  <script type="text/javascript" src="javascripts/flowchart_generator.js"></script>
  <script type="text/javascript" src="javascripts/tree_generator.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-115746206-1"></script>
  <script type="text/javascript" src="javascripts/abcjs_midi_5.1.2-min.js"></script>
  <script type="text/javascript" src="javascripts/music_generator.js"></script>
  <script type="text/javascript" src="javascripts/zoom.min.js"></script>
  <script type="text/javascript" src="javascripts/zoom_init.js"></script>
  <script type="text/javascript" src="javascripts/transition.js"></script>
  <script type="text/javascript" src="javascripts/chart.js"></script>
  <script type="text/javascript" src="javascripts/chart_generator.js"></script>
  <script type="text/javascript" src="javascripts/webfont.js"></script>
  <script type="text/javascript" src="javascripts/snap.svg-min.js"></script>
  <script type="text/javascript" src="javascripts/underscore-min.js"></script>
  <script type="text/javascript" src="javascripts/sequence-diagram-min.js"></script>
  <script type="text/javascript" src="javascripts/diagram_generator.js"></script>

  <script type="text/javascript">
    syntaxhighlighterConfig = {
      autoLinks: false,
    };

    $(guidesIndex.bind);

    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-115746206-1');
  </script>

  <script type="text/javascript">
    var locationId = (location.pathname).split("/").pop().substring(0, 49);

    if (locationId) {
      var language = window.location.search.match("lang=en") ? "en" : "zh-CN"

      if (window.location.href.match("github")) {
        var gitalk = new Gitalk({
          clientID: '85c5f833b04d6d470db9',
          clientSecret: 'b41619fc891132558550103056197eb30baebab5',
          repo: 'blog-github-page-comments',
          owner: 'dengqinghua',
          admin: ['dengqinghua'],
          id: locationId,
          distractionFreeMode: true,
          language: language
        });
      } else {
        var gitalk = new Gitalk({
          clientID: '0f5824fe1c09851e9781',
          clientSecret: '61710a77ee98cddce06f408a398f05c8622e9575',
          repo: 'blog_comments',
          owner: 'dengqinghua',
          admin: ['dengqinghua'],
          id: locationId,
          distractionFreeMode: true,
          language: language
        });
      }

      gitalk.render('comment');
    }
  </script>
</body>
</html>
